<div class="space-y-8">

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Card 1 -->
    <div class="bg-white p-6 rounded-3xl shadow-sm border border-surface-200">
      <div class="flex items-center justify-between mb-4">
        <span class="text-surface-500 font-medium text-sm">Pending Admins</span>
        <div class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center">
          <i class="fas fa-user-clock"></i>
        </div>
      </div>
      <div class="text-3xl font-black text-emerald-950">{{ pendingRequests }}</div>
      <div class="text-sm text-green-600 font-bold mt-2 flex items-center gap-1">
        <i class="fas fa-arrow-up text-xs"></i> 12% <span class="text-surface-400 font-normal">vs last week</span>
      </div>
    </div>

    <!-- Card 2 -->
    <div class="bg-white p-6 rounded-3xl shadow-sm border border-surface-200">
      <div class="flex items-center justify-between mb-4">
        <span class="text-surface-500 font-medium text-sm">Total Admins</span>
        <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center">
          <i class="fas fa-users"></i>
        </div>
      </div>
      <div class="text-3xl font-black text-emerald-950">{{ totalAdmins }}</div>
    </div>

    <!-- Card 3 -->
    <div class="bg-white p-6 rounded-3xl shadow-sm border border-surface-200">
      <div class="flex items-center justify-between mb-4">
        <span class="text-surface-500 font-medium text-sm">Entries Today</span>
        <div class="w-10 h-10 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center">
          <i class="fas fa-tag"></i>
        </div>
      </div>
      <div class="text-3xl font-black text-emerald-950">{{ todayEntries }}</div>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="space-y-8">

    <!-- Pending User Requests Table -->
    <div class="bg-white rounded-3xl border border-surface-200 overflow-hidden shadow-sm">
      <p-table [value]="adminRequests" [paginator]="true" [rows]="5" [loading]="isLoading" responsiveLayout="scroll"
        styleClass="p-datatable-lg" [tableStyle]="{'min-width': '60rem'}">

        <ng-template pTemplate="caption">
          <div class="flex items-center justify-between p-4 ">
            <h2 class="text-xl font-bold !text-white">Pending User Approvals</h2>
            <button pButton label="Refresh" icon="fas fa-sync-alt"
              class="p-button-text p-button-rounded p-button-secondary !text-white hover:!text-gray-200"
              (click)="loadAdminRequests()"></button>
          </div>
        </ng-template>

        <ng-template pTemplate="header">
          <tr class="bg-surface-50 border-b border-surface-200">
            <th class="!text-white font-bold p-4">Name</th>
            <th class="!text-white font-bold p-4">Email</th>
            <th class="!text-white font-bold p-4">Organization</th>
            <th class="!text-white font-bold p-4">Region</th>
            <th class="!text-white font-bold p-4">Status</th>
            <th class="!text-white font-bold p-4">Action</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-request>
          <tr class="border-b border-surface-100 hover:bg-surface-50 transition-colors">
            <td class="!text-white font-bold p-4">{{ request.full_name }}</td>
            <td class="!text-white p-4">{{ request.email }}</td>
            <td class="!text-white p-4">{{ request.organization }}</td>
            <td class="p-4">
              <span
                class="px-3 py-1 bg-surface-100 rounded-full text-xs font-bold text-gray-700 uppercase tracking-wider">{{
                request.region }}</span>
            </td>
            <td class="p-4">
              <p-tag [value]="request.status" [severity]="request.status === 'pending' ? 'warn' : 'success'"></p-tag>
            </td>
            <td class="p-4">
              <button pButton icon="fas fa-eye"
                class="p-button-rounded p-button-text !text-white p-button-sm !text-emerald-300 hover:!bg-emerald-50"
                (click)="viewRequest(request)"></button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6" class="text-center p-8 text-gray-500">No pending requests found.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <!-- Pending Price Verifications Table -->
    <div class="bg-white rounded-3xl border border-surface-200 overflow-hidden shadow-sm">
      <p-table [value]="pendingVerifications" [paginator]="true" [rows]="10" [loading]="isLoading"
        responsiveLayout="scroll" styleClass="p-datatable-lg" [tableStyle]="{'min-width': '60rem'}">

        <ng-template pTemplate="caption">
          <div class="flex items-center justify-between p-4">
            <h2 class="text-xl font-bold !text-white">Pending Price Verifications</h2>
            <button pButton label="Refresh" icon="fas fa-sync-alt"
              class="p-button-text p-button-rounded p-button-secondary !text-white hover:!text-gray-200"
              (click)="loadPendingVerifications()"></button>
          </div>
        </ng-template>

        <ng-template pTemplate="header">
          <tr class="bg-surface-50 border-b border-surface-200">
            <th class="!text-white font-bold p-4">Crop</th>
            <th class="!text-white font-bold p-4">Price (KES)</th>
            <th class="!text-white font-bold p-4">Market</th>
            <th class="!text-white font-bold p-4">Submitted By</th>
            <th class="!text-white font-bold p-4">Date</th>
            <th class="!text-white font-bold p-4">Actions</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-entry>
          <tr class="border-b border-surface-100 hover:bg-surface-50 transition-colors">
            <td class="!text-white font-bold p-4">{{ entry.crop_name }}</td>
            <td class="!text-emerald-300 font-black p-4">{{ entry.price | currency:'KES ':'symbol':'1.0-0' }}</td>
            <td class="!text-white p-4">{{ entry.market_name }}</td>
            <td class="!text-white p-4">{{ entry.entered_by_name }}</td>
            <td class="!text-white p-4">{{ formatDate(entry.entry_date) }}</td>
            <td class="p-4 flex gap-2">
              <button pButton icon="fas fa-check" label="Verify"
                class="p-button-rounded p-button-success p-button-sm p-button-outlined"
                (click)="verifyEntry(entry.id)"></button>
              <button pButton icon="fas fa-times" label="Reject"
                class="p-button-rounded p-button-danger p-button-sm p-button-outlined"
                (click)="rejectEntry(entry.id)"></button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6" class="text-center p-8 text-gray-500">No pending price verifications.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- Request Detail Dialog -->
  <p-dialog header="Admin Request Details" [(visible)]="requestDialogVisible" [modal]="true"
    [style]="{width: '90vw', maxWidth: '600px'}" [draggable]="false" [resizable]="false" styleClass="p-dialog-rounded">

    <div *ngIf="selectedRequest" class="flex flex-col gap-6 py-4">

      <div class="flex items-center gap-4 p-4 bg-surface-50 rounded-2xl border border-surface-100">
        <div
          class="w-16 h-16 bg-emerald-100 text-emerald-700 rounded-full flex items-center justify-center text-2xl font-black shadow-inner">
          {{ selectedRequest.full_name.charAt(0) }}
        </div>
        <div>
          <h3 class="text-xl font-black !text-emerald-950">{{ selectedRequest.full_name }}</h3>
          <p class="!text-surface-500">{{ selectedRequest.organization }}</p>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div class="p-3 border border-surface-100 rounded-xl">
          <p class="text-xs text-surface-400 uppercase font-bold tracking-wider mb-1">Email</p>
          <p class="text-sm font-semibold !text-white break-all">{{ selectedRequest.email }}</p>
        </div>
        <div class="p-3 border border-surface-100 rounded-xl">
          <p class="text-xs text-surface-400 uppercase font-bold tracking-wider mb-1">Phone</p>
          <p class="text-sm font-semibold !text-white">{{ selectedRequest.phone }}</p>
        </div>
        <div class="p-3 border border-surface-100 rounded-xl">
          <p class="text-xs text-surface-400 uppercase font-bold tracking-wider mb-1">Region</p>
          <p class="text-sm font-semibold !text-white">{{ selectedRequest.region }}</p>
        </div>
        <div class="p-3 border border-surface-100 rounded-xl">
          <p class="text-xs text-surface-400 uppercase font-bold tracking-wider mb-1">Date</p>
          <p class="text-sm font-semibold !text-white">{{ formatDate(selectedRequest.created_at) }}</p>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex gap-2 w-full pt-4 border-t border-surface-100">
        <button pButton label="Reject" class="p-button-text p-button-danger flex-1"
          (click)="rejectRequest(selectedRequest!.id); requestDialogVisible = false"></button>
        <button pButton label="Approve" class="p-button-success flex-1"
          (click)="approveRequest(selectedRequest!.id); requestDialogVisible = false"></button>
      </div>
    </ng-template>

  </p-dialog>

</div>